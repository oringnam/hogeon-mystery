<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í˜¸ê±´ì´ë¥¼ ì°¾ì•„ì„œ - 9ë…„ ë§Œì˜ ë¯¸ìŠ¤í„°ë¦¬</title>
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://oringnam.github.io/hogeon-mystery/">
    <meta property="og:title" content="í˜¸ê±´ì´ë¥¼ ì°¾ì•„ì„œ">
    <meta property="og:description" content="2017ë…„ë¶€í„° ì—°ë½ì´ ëŠê¸´ ì¹œêµ¬. 9ëª…ì˜ ì¹œêµ¬ë“¤ì´ ê·¸ë¥¼ ì°¾ì•„ ë‚˜ì„­ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì„ íƒì´ ì§„ì‹¤ì„ ê²°ì •í•©ë‹ˆë‹¤.">
    <meta property="og:image" content="https://oringnam.github.io/hogeon-mystery/og-image.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://oringnam.github.io/hogeon-mystery/">
    <meta property="twitter:title" content="í˜¸ê±´ì´ë¥¼ ì°¾ì•„ì„œ">
    <meta property="twitter:description" content="2017ë…„ë¶€í„° ì—°ë½ì´ ëŠê¸´ ì¹œêµ¬. 9ëª…ì˜ ì¹œêµ¬ë“¤ì´ ê·¸ë¥¼ ì°¾ì•„ ë‚˜ì„­ë‹ˆë‹¤.">
    <meta property="twitter:image" content="https://oringnam.github.io/hogeon-mystery/og-image.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #333;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 40px rgba(0,0,0,0.3);
        }

        .game-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            flex-shrink: 0;
            position: relative;
        }

        .game-header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .game-header p {
            opacity: 0.9;
            font-size: 0.85em;
        }

        .version-info {
            font-size: 0.7em;
            opacity: 0.7;
            margin-top: 5px;
        }

        .header-buttons {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .progress-bar {
            margin-top: 10px;
            font-size: 0.8em;
            opacity: 0.85;
        }

        .progress-indicator {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            margin-top: 5px;
        }

        /* ë‹¨ì„œ ë…¸íŠ¸ ëª¨ë‹¬ */
        .clue-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        .clue-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .clue-content {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .clue-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .clue-header h2 {
            font-size: 1.3em;
        }

        .close-clue {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
        }

        .clue-body {
            padding: 20px;
        }

        .clue-item {
            padding: 12px;
            margin-bottom: 10px;
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            border-radius: 8px;
        }

        .clue-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }

        .no-clues {
            text-align: center;
            color: #999;
            padding: 40px 20px;
        }

        /* ëŒ€í™”ì°½ + ì„ íƒì§€ ì˜ì—­ */
        .game-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .story-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            line-height: 1.8;
            background: #f8f9fa;
        }

        /* ì¼ë°˜ í…ìŠ¤íŠ¸ ë¸”ë¡ */
        .story-block {
            margin-bottom: 20px;
            padding: 16px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            animation: fadeIn 0.3s;
        }

        .story-block p {
            margin-bottom: 12px;
            line-height: 1.8;
        }

        .story-block p:last-child {
            margin-bottom: 0;
        }

        /* í—¤ë” (ì±•í„° êµ¬ë¶„) */
        .chapter-header {
            margin: 30px 0 20px 0;
            padding-bottom: 12px;
            border-bottom: 3px solid #667eea;
            animation: fadeIn 0.3s;
        }

        .chapter-header h1 {
            font-size: 1.4em;
            color: #667eea;
            font-weight: bold;
        }

        /* ì„ íƒí•œ ëŒ€í™” (íŒŒë€ìƒ‰) */
        .choice-made {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            animation: fadeIn 0.3s;
        }

        .choice-made::before {
            content: 'â–¸ ';
            font-weight: bold;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì„ íƒì§€ ì˜ì—­ (ê³ ì •) */
        .choices {
            padding: 15px 20px;
            background: white;
            border-top: 2px solid #e0e0e0;
            flex-shrink: 0;
            max-height: 40vh;
            overflow-y: auto;
        }

        .choice-button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-family: inherit;
            color: #333;
        }

        .choice-button:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .choice-button:active {
            transform: translateY(0);
        }

        .choice-button::before {
            content: 'â–¸ ';
            color: #667eea;
            font-weight: bold;
        }

        /* ìŠ¤í† ë¦¬ ì´ë¯¸ì§€ */
        .story-image {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: fadeIn 0.5s;
        }

        .story-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .story-image.placeholder {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            aspect-ratio: 4/3;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: white;
        }

        /* ì—”ë”© ëª¨ë‹¬ */
        .ending-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .ending-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .ending-content {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideUp 0.4s;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ending-image {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px 20px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5em;
            color: white;
        }

        .ending-body {
            padding: 30px;
        }

        .ending-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .ending-description {
            color: #666;
            line-height: 1.8;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.05em;
        }

        .ending-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.9em;
            color: #666;
        }

        .ending-actions {
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .copy-notification {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 2000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .copy-notification.show {
            display: block;
            animation: slideUp 0.3s;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .story-container::-webkit-scrollbar,
        .choices::-webkit-scrollbar,
        .ending-content::-webkit-scrollbar {
            width: 8px;
        }

        .story-container::-webkit-scrollbar-track,
        .choices::-webkit-scrollbar-track,
        .ending-content::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .story-container::-webkit-scrollbar-thumb,
        .choices::-webkit-scrollbar-thumb,
        .ending-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 600px) {
            .game-header h1 { font-size: 1.3em; }
            .story-container { padding: 15px; }
            .choices { padding: 12px 15px; }
            .choice-button { padding: 12px 16px; font-size: 0.9em; }
            .ending-title { font-size: 1.5em; }
            .ending-body { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <div class="header-buttons">
                <button class="header-btn" onclick="showClues()">ğŸ“‹ ë‹¨ì„œ</button>
            </div>
            <h1>ğŸ” í˜¸ê±´ì´ë¥¼ ì°¾ì•„ì„œ</h1>
            <p>9ë…„ ë§Œì˜ ë¯¸ìŠ¤í„°ë¦¬ë¥¼ í’€ì–´ë³´ì„¸ìš”</p>
            <div class="version-info">v3.17 (2026-02-14 17:33 KST) - Headcount Fix (ì´ 10ëª…)</div>
            <div class="progress-bar">
                <div class="progress-indicator" id="progressIndicator">
                    ì¡°ì‚¬ ì‹œì‘ ì „
                </div>
            </div>
        </div>

        <div class="game-body">
            <div class="story-container" id="story">
                <div class="loading">ìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>

            <div class="choices" id="choices" style="display: none;"></div>
        </div>
    </div>

    <!-- ì—”ë”© ëª¨ë‹¬ -->
    <div class="ending-modal" id="endingModal">
        <div class="ending-content">
            <div class="ending-image" id="endingImage">
                ğŸ­
            </div>
            <div class="ending-body">
                <div class="ending-title" id="endingTitle">ì´ì•¼ê¸°ê°€ ëë‚¬ìŠµë‹ˆë‹¤</div>
                <div class="ending-description" id="endingDescription">
                    í˜¸ê±´ì´ë¥¼ ì°¾ëŠ” ì—¬ì •ì´ ëë‚¬ìŠµë‹ˆë‹¤.
                </div>
                <div class="ending-stats" id="endingStats"></div>
                <div class="ending-actions">
                    <button class="btn btn-primary" onclick="shareEnding()">
                        ğŸ“¤ ê³µìœ í•˜ê¸°
                    </button>
                    <button class="btn btn-secondary" onclick="location.reload()">
                        ğŸ”„ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë³µì‚¬ ì•Œë¦¼ -->
    <div class="copy-notification" id="copyNotification">
        âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!
    </div>

    <!-- ë‹¨ì„œ ë…¸íŠ¸ ëª¨ë‹¬ -->
    <div class="clue-modal" id="clueModal">
        <div class="clue-content">
            <div class="clue-header">
                <h2>ğŸ” ìˆ˜ì§‘í•œ ë‹¨ì„œ</h2>
                <button class="close-clue" onclick="hideClues()">Ã—</button>
            </div>
            <div class="clue-body" id="clueList">
                <div class="no-clues">ì•„ì§ ìˆ˜ì§‘í•œ ë‹¨ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </div>
    </div>

    <!-- inkjs ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ (ë²„ì „ 2.3.0) -->
    <script src="https://unpkg.com/inkjs@2.3.0/dist/ink.js"></script>

    <script>
        let story;
        let currentEnding = null;
        const storyContainer = document.getElementById('story');
        const choicesContainer = document.getElementById('choices');

        // ë‹¨ì„œ ì •ë³´ ë§µ
        const clueInfo = {
            'clue_lotto': { name: 'ë¡œë˜ ë‹¹ì²¨', desc: 'ë™ëŒ€ë¬¸êµ¬ì—ì„œ 1ë“± ë‹¹ì²¨ ê¸°ë¡ ë°œê²¬' },
            'clue_ship': { name: 'ì›ì–‘ì–´ì„ ', desc: 'ë¶€ì‚° ì„ ë°•íšŒì‚¬ ê·¼ë¬´ ì¤‘' },
            'clue_prison': { name: 'ë³µì—­ ì¤‘', desc: 'êµí†µì‚¬ê³  ì¹˜ì‚¬ë¡œ ìˆ˜ê°' },
            'clue_hospital': { name: 'êµí†µì‚¬ê³ ', desc: '2017ë…„ ì‚¬ê³  í›„ ì˜ì‹ë¶ˆëª…' },
            'clue_fantasy': { name: 'ì´ì„¸ê³„', desc: 'ì›ë£¸ì—ì„œ ë¯¸ìŠ¤í„°ë¦¬í•œ í”ì ' },
            'clue_spy': { name: 'êµ­ì •ì›', desc: 'ì²´ë ¥ ë‹¨ë ¨, ì •ë³´ë³´ì•ˆ ìˆ˜ê°•' },
            'clue_religion': { name: 'ì¶œê°€', desc: 'ê°•ì›ë„ ì‚°ì‚¬ì—ì„œ ìˆ˜í–‰ ì¤‘' },
            'clue_business': { name: 'ì‚¬ì—… ì‹¤íŒ¨', desc: '1ì–µ ê°€ê¹Œìš´ ë¹š' },
            'clue_witness': { name: 'ì¦ì¸ë³´í˜¸', desc: 'í­ë ¥ ì‚¬ê±´ ëª©ê²© í›„ ë³´í˜¸ ì¤‘' }
        };

        // ì—”ë”© ì •ë³´ ë§µ
        const endings = {
            'lotto': { title: 'ë¡œë˜ ë‹¹ì²¨ì˜ ê³ ë…', emoji: 'ğŸ°', desc: 'ëˆì€ ëª¨ë“  ê±¸ í•´ê²°í•˜ì§€ ëª»í•œë‹¤.' },
            'ship': { title: 'ë°”ë‹¤ì˜ ë‚¨ì', emoji: 'ğŸš¢', desc: 'ì–´ë–¤ ê¸¸ì„ ê°€ë“ , ì¹œêµ¬ëŠ” ì¹œêµ¬ë‹¤.' },
            'coma': { title: 'ì ë“  ì¹œêµ¬', emoji: 'ğŸ¥', desc: 'ê¸°ë‹¤ë¦¼ì€ ëë‚˜ì§€ ì•ŠëŠ”ë‹¤.' },
            'witness': { title: 'ì¦ì¸ì˜ ê·€í™˜', emoji: 'ğŸ›¡ï¸', desc: 'ì •ì˜ë¥¼ ìœ„í•œ í¬ìƒë„ ìˆë‹¤.' },
            'fantasy': { title: 'ì´ì„¸ê³„ ì „ì´ ì „ì„¤', emoji: 'âœ¨', desc: 'ë¯¿ê±°ë‚˜ ë§ê±°ë‚˜.' },
            'spy': { title: 'ê·¸ë¦¼ì ìš”ì›', emoji: 'ğŸ‘ï¸', desc: 'ì–´ë–¤ ì˜ì›…ì€ ë¹›ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤.' },
            'religion': { title: 'ê¹¨ë‹¬ìŒì˜ ê¸¸', emoji: 'ğŸ™', desc: 'ê°ìì˜ í‰í™”ë¥¼ ì°¾ëŠ” ë²•ì€ ë‹¤ë¥´ë‹¤.' },
            'business': { title: 'ì¬ê¸°ì˜ ì„¬', emoji: 'ğŸ’¼', desc: 'ì‹¤íŒ¨ëŠ” ëì´ ì•„ë‹ˆë‹¤.' },
            'prison': { title: 'ì†ì£„ì™€ ìš©ì„œ', emoji: 'âš–ï¸', desc: 'ê³¼ê±°ëŠ” ì§€ìš¸ ìˆ˜ ì—†ì§€ë§Œ, ë¯¸ë˜ëŠ” ë§Œë“¤ ìˆ˜ ìˆë‹¤.' }
        };

        // ìŠ¤í† ë¦¬ ë¡œë“œ (ë²„ì „ íŒŒë¼ë¯¸í„°ë¡œ ìºì‹œ ìš°íšŒ)
        fetch('story.json?v=3.17')
            .then(response => {
                if (!response.ok) {
                    throw new Error('story.jsonì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì»´íŒŒì¼ í•´ì£¼ì„¸ìš”.');
                }
                return response.json();
            })
            .then(storyData => {
                story = new inkjs.Story(storyData);
                storyContainer.innerHTML = ''; // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                updateProgress(); // ì´ˆê¸° ì§„í–‰ë„ ì—…ë°ì´íŠ¸
                continueStory();
            })
            .catch(error => {
                storyContainer.innerHTML = `
                    <div style="color: red; padding: 40px; text-align: center;">
                        <h2>âš ï¸ ì˜¤ë¥˜ ë°œìƒ</h2>
                        <p>${error.message}</p>
                        <p style="margin-top: 20px; font-size: 0.9em; color: #666;">
                            story.ink íŒŒì¼ì„ ì»´íŒŒì¼í•˜ì…¨ë‚˜ìš”?<br>
                            <code>inklecate -o story.json story.ink</code>
                        </p>
                    </div>
                `;
            });

        function continueStory() {
            // ì—°ì†ëœ í…ìŠ¤íŠ¸ë¥¼ í•˜ë‚˜ì˜ ë¸”ë¡ìœ¼ë¡œ ë¬¶ê¸°
            let currentBlock = null;
            
            while (story.canContinue) {
                const line = story.Continue();
                
                // íƒœê·¸ ì²´í¬ (ì—”ë”© íƒ€ì… + ì´ë¯¸ì§€)
                const tags = story.currentTags;
                if (tags && tags.length > 0) {
                    tags.forEach(tag => {
                        if (tag.startsWith('ENDING:')) {
                            currentEnding = tag.replace('ENDING:', '').trim();
                            console.log('âœ… Ending detected:', currentEnding);
                        }
                        if (tag.startsWith('IMAGE:')) {
                            const filename = tag.replace('IMAGE:', '').trim();
                            renderImage(filename);
                            currentBlock = null; // ì´ë¯¸ì§€ í›„ ìƒˆ ë¸”ë¡ ì‹œì‘
                        }
                    });
                }
                
                if (line.trim() !== '') {
                    // í—¤ë” (# ìœ¼ë¡œ ì‹œì‘)
                    if (line.trim().startsWith('# ')) {
                        // ì´ì „ ë¸”ë¡ ë§ˆê°
                        currentBlock = null;
                        
                        // ì—”ë”© í—¤ë” ê°ì§€
                        const headerText = line.replace('# ', '').trim();
                        if (headerText.startsWith('ì—”ë”©')) {
                            // ì—”ë”© íƒ€ì… ê°ì§€
                            detectEnding(headerText);
                        }
                        
                        // í—¤ë” ì¶”ê°€
                        const headerDiv = document.createElement('div');
                        headerDiv.className = 'chapter-header';
                        const h1 = document.createElement('h1');
                        h1.textContent = headerText;
                        headerDiv.appendChild(h1);
                        storyContainer.appendChild(headerDiv);
                    } else {
                        // ì¼ë°˜ í…ìŠ¤íŠ¸ - ë¸”ë¡ì— ëˆ„ì 
                        if (!currentBlock) {
                            currentBlock = document.createElement('div');
                            currentBlock.className = 'story-block';
                            storyContainer.appendChild(currentBlock);
                        }
                        
                        const p = document.createElement('p');
                        // ë³¼ë“œ ì²˜ë¦¬ (**text**)
                        let formattedLine = line.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                        p.innerHTML = formattedLine;
                        currentBlock.appendChild(p);
                    }
                }
            }

            // ìë™ ìŠ¤í¬ë¡¤ (tailë¡œ)
            scrollToBottom();

            // ì„ íƒì§€ ì¶œë ¥
            const choices = story.currentChoices;
            
            if (choices.length > 0) {
                choicesContainer.style.display = 'block';
                choicesContainer.innerHTML = '';
                
                choices.forEach((choice, index) => {
                    const button = document.createElement('button');
                    button.className = 'choice-button';
                    button.textContent = choice.text;
                    button.onclick = () => selectChoice(index, choice.text);
                    choicesContainer.appendChild(button);
                });
            } else {
                // ìŠ¤í† ë¦¬ ë - ì—”ë”© ì„ íƒì§€ í‘œì‹œ
                choicesContainer.style.display = 'block';
                const endingButton = document.createElement('button');
                endingButton.className = 'choice-button';
                endingButton.textContent = 'ğŸ ì—”ë”© ë³´ê¸°';
                endingButton.onclick = () => showEndingModal();
                choicesContainer.appendChild(endingButton);
            }

            // ì§„í–‰ë„ ì—…ë°ì´íŠ¸
            updateProgress();
        }

        function renderImage(filename) {
            const imageContainer = document.createElement('div');
            imageContainer.className = 'story-image';
            
            const imagePath = `images/${filename}`;
            
            // ì´ë¯¸ì§€ ë¡œë“œ ì‹œë„
            const img = new Image();
            img.onload = function() {
                // ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ
                const imgElement = document.createElement('img');
                imgElement.src = imagePath;
                imgElement.alt = 'Story Image';
                imageContainer.appendChild(imgElement);
            };
            img.onerror = function() {
                // ì´ë¯¸ì§€ ì—†ìœ¼ë©´ placeholder (ì´ëª¨ì§€)
                const placeholderEmoji = getPlaceholderEmoji(filename);
                imageContainer.classList.add('placeholder');
                imageContainer.textContent = placeholderEmoji;
            };
            img.src = imagePath;
            
            storyContainer.appendChild(imageContainer);
        }

        function getPlaceholderEmoji(filename) {
            // íŒŒì¼ëª… ê¸°ë°˜ ì´ëª¨ì§€ placeholder
            if (filename.includes('prologue')) return 'â˜•';
            if (filename.includes('lotto')) return 'ğŸ°';
            if (filename.includes('ship')) return 'ğŸš¢';
            if (filename.includes('hospital')) return 'ğŸ¥';
            if (filename.includes('witness')) return 'ğŸ›¡ï¸';
            if (filename.includes('isekai')) return 'âœ¨';
            if (filename.includes('spy')) return 'ğŸ‘ï¸';
            if (filename.includes('religion')) return 'ğŸ™';
            if (filename.includes('business')) return 'ğŸ’¼';
            if (filename.includes('prison')) return 'âš–ï¸';
            return 'ğŸ–¼ï¸';
        }

        function getCollectedEndings() {
            return JSON.parse(localStorage.getItem('hogeon_endings') || '[]');
        }

        function detectEnding(headerText) {
            // "ì—”ë”© 1: ë¡œë˜ ë‹¹ì²¨" ê°™ì€ í˜•ì‹ì—ì„œ íƒ€ì… ì¶”ì¶œ
            if (headerText.includes('ë¡œë˜')) currentEnding = 'lotto';
            else if (headerText.includes('ì›ì–‘') || headerText.includes('ë°”ë‹¤')) currentEnding = 'ship';
            else if (headerText.includes('ì½”ë§ˆ') || headerText.includes('ì ë“ ')) currentEnding = 'coma';
            else if (headerText.includes('ì¦ì¸')) currentEnding = 'witness';
            else if (headerText.includes('ì´ì„¸ê³„')) currentEnding = 'fantasy';
            else if (headerText.includes('êµ­ì •ì›') || headerText.includes('ìš”ì›')) currentEnding = 'spy';
            else if (headerText.includes('ì¢…êµ') || headerText.includes('ì¶œê°€') || headerText.includes('ê¹¨ë‹¬ìŒ')) currentEnding = 'religion';
            else if (headerText.includes('ì‚¬ì—…') || headerText.includes('ì¬ê¸°')) currentEnding = 'business';
            else if (headerText.includes('ì¶œì†Œ') || headerText.includes('ì†ì£„')) currentEnding = 'prison';
        }

        function showEndingModal() {
            const modal = document.getElementById('endingModal');
            const endingData = endings[currentEnding] || endings.ship; // fallback
            
            // ì—”ë”© ìˆ˜ì§‘ (ë¡œì»¬ìŠ¤í† ë¦¬ì§€)
            let collectedEndings = getCollectedEndings();
            if (currentEnding && !collectedEndings.includes(currentEnding)) {
                collectedEndings.push(currentEnding);
                localStorage.setItem('hogeon_endings', JSON.stringify(collectedEndings));
            }
            
            const endingCount = collectedEndings.length;
            const isNewEnding = currentEnding && collectedEndings[collectedEndings.length - 1] === currentEnding;
            
            document.getElementById('endingImage').textContent = endingData.emoji;
            document.getElementById('endingTitle').textContent = endingData.title;
            
            let description = endingData.desc;
            if (isNewEnding && endingCount > 1) {
                description += `\n\nâœ¨ ìƒˆë¡œìš´ ì—”ë”© ë°œê²¬! (${endingCount}/9)`;
            } else if (endingCount === 9) {
                description += '\n\nğŸ‰ ëª¨ë“  ì—”ë”©ì„ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤!';
            } else {
                description += `\n\nìˆ˜ì§‘í•œ ì—”ë”©: ${endingCount}/9`;
            }
            
            document.getElementById('endingDescription').textContent = description;
            
            // í†µê³„ ì •ë³´ í‘œì‹œ
            const statsHTML = `
                <div style="display: flex; justify-content: space-around; margin-top: 10px;">
                    <div>
                        <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">${endingCount}</div>
                        <div style="font-size: 0.85em;">ìˆ˜ì§‘í•œ ì—”ë”©</div>
                    </div>
                    <div style="border-left: 1px solid #ddd;"></div>
                    <div>
                        <div style="font-size: 1.5em; font-weight: bold; color: #764ba2;">9</div>
                        <div style="font-size: 0.85em;">ì „ì²´ ì—”ë”©</div>
                    </div>
                </div>
            `;
            document.getElementById('endingStats').innerHTML = statsHTML;
            
            modal.classList.add('show');
        }

        function shareEnding() {
            try {
                console.log('shareEnding called'); // DEBUG
                
                const endingData = endings[currentEnding] || endings.ship;
                const collectedEndings = getCollectedEndings().length;
                
                const shareText = `ğŸ” í˜¸ê±´ì´ë¥¼ ì°¾ì•„ì„œ

${endingData.emoji} ${endingData.title}

ë‚˜ëŠ” ${collectedEndings}/9ê°œ ì—”ë”©ì„ ìˆ˜ì§‘í–ˆì–´!
ë„ˆë„ í˜¸ê±´ì´ë¥¼ ì°¾ì•„ë´!

https://oringnam.github.io/hogeon-mystery/`;

                console.log('Share text prepared:', shareText); // DEBUG
                
                // ë°”ë¡œ í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹œë„
                copyToClipboardDirect(shareText);
            } catch (err) {
                console.error('shareEnding error:', err);
                alert('ê³µìœ  ê¸°ëŠ¥ ì˜¤ë¥˜: ' + err.message);
            }
        }
        
        function copyToClipboardDirect(text) {
            // Method 1: Clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        console.log('Clipboard API success');
                        showNotification('âœ… ë³µì‚¬ ì™„ë£Œ! ì¹´í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”');
                    })
                    .catch((err) => {
                        console.log('Clipboard API failed, trying fallback:', err);
                        copyViaTextareaMethod(text);
                    });
                return;
            }
            
            // Method 2: Fallback - textarea
            console.log('Clipboard API not available, using textarea');
            copyViaTextareaMethod(text);
        }
        
        function copyViaTextareaMethod(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.top = '0';
            textarea.style.left = '0';
            textarea.style.opacity = '0';
            textarea.style.pointerEvents = 'none';
            document.body.appendChild(textarea);
            
            try {
                textarea.focus();
                textarea.select();
                textarea.setSelectionRange(0, 99999);
                
                const success = document.execCommand('copy');
                console.log('execCommand result:', success);
                
                if (success) {
                    showNotification('âœ… ë³µì‚¬ ì™„ë£Œ! ì¹´í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”');
                } else {
                    // Last resort: show modal for manual copy
                    showShareTextModal(text);
                }
            } catch (err) {
                console.log('execCommand error:', err);
                showShareTextModal(text);
            } finally {
                document.body.removeChild(textarea);
            }
        }
        
        function showNotification(message) {
            const notification = document.getElementById('copyNotification');
            if (notification) {
                notification.textContent = message;
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }
        }

        // ì´ í•¨ìˆ˜ë“¤ì€ ë” ì´ìƒ ì‚¬ìš© ì•ˆ í•¨ (ì£¼ì„ ì²˜ë¦¬)
        // shareEnding()ì—ì„œ ì§ì ‘ ëª¨ë‹¬ í‘œì‹œ
        
        function showShareTextModal(text) {
            console.log('Showing manual copy modal'); // DEBUG
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 24px;
                border-radius: 12px;
                max-width: 500px;
                width: 100%;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            
            content.innerHTML = `
                <h3 style="margin: 0 0 12px 0; color: #333;">ğŸ“¤ ê³µìœ í•˜ê¸°</h3>
                <p style="margin: 0 0 16px 0; font-size: 14px; color: #666;">
                    ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ <strong>ê¸¸ê²Œ ëˆŒëŸ¬ì„œ</strong> ì „ì²´ ì„ íƒ í›„ ë³µì‚¬í•˜ì„¸ìš”:
                </p>
                <textarea 
                    readonly 
                    id="shareTextArea"
                    style="
                        width: 100%; 
                        height: 180px; 
                        padding: 12px; 
                        border: 2px solid #667eea; 
                        border-radius: 8px; 
                        font-size: 14px;
                        line-height: 1.5;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        resize: none;
                        box-sizing: border-box;
                    "
                >${text}</textarea>
                <div style="margin-top: 16px; display: flex; gap: 8px;">
                    <button 
                        id="copyButtonInModal"
                        style="
                            flex: 1;
                            padding: 12px;
                            background: #667eea;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 15px;
                            font-weight: 600;
                            cursor: pointer;
                        "
                    >
                        ğŸ“‹ ë³µì‚¬í•˜ê¸°
                    </button>
                    <button 
                        id="closeModalButton"
                        style="
                            flex: 1;
                            padding: 12px;
                            background: #e0e0e0;
                            color: #333;
                            border: none;
                            border-radius: 8px;
                            font-size: 15px;
                            font-weight: 600;
                            cursor: pointer;
                        "
                    >
                        ë‹«ê¸°
                    </button>
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // ë³µì‚¬ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('copyButtonInModal').addEventListener('click', function() {
                const textarea = document.getElementById('shareTextArea');
                textarea.select();
                textarea.setSelectionRange(0, 99999); // For mobile
                
                try {
                    // Try clipboard API first
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(text).then(() => {
                            this.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                            this.style.background = '#4CAF50';
                        }).catch(() => {
                            // Fallback to execCommand
                            const success = document.execCommand('copy');
                            if (success) {
                                this.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                                this.style.background = '#4CAF50';
                            }
                        });
                    } else {
                        // Use execCommand directly
                        const success = document.execCommand('copy');
                        if (success) {
                            this.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
                            this.style.background = '#4CAF50';
                        } else {
                            this.textContent = 'âŒ ì‹¤íŒ¨ - ê¸¸ê²Œ ëˆŒëŸ¬ ë³µì‚¬';
                        }
                    }
                } catch (err) {
                    console.error('Copy error:', err);
                    this.textContent = 'âŒ ì‹¤íŒ¨ - ê¸¸ê²Œ ëˆŒëŸ¬ ë³µì‚¬';
                }
            });
            
            // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('closeModalButton').addEventListener('click', function() {
                modal.remove();
            });
            
            // Auto-focus and select
            setTimeout(() => {
                const textarea = document.getElementById('shareTextArea');
                textarea.focus();
                textarea.select();
            }, 100);
        }

        function selectChoice(index, choiceText) {
            // ì„ íƒí•œ ê²ƒì„ íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œ
            const choiceDiv = document.createElement('div');
            choiceDiv.className = 'choice-made';
            choiceDiv.textContent = choiceText;
            storyContainer.appendChild(choiceDiv);

            // ìŠ¤í† ë¦¬ ì§„í–‰
            story.ChooseChoiceIndex(index);
            
            // ì„ íƒì§€ ìˆ¨ê¸°ê¸° (ë‹¤ìŒ í…ìŠ¤íŠ¸ ë³´ì—¬ì£¼ê¸° ì „ì—)
            choicesContainer.style.display = 'none';
            
            // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ë‹¤ìŒ ìŠ¤í† ë¦¬
            setTimeout(() => {
                continueStory();
            }, 100);
        }

        function scrollToBottom() {
            storyContainer.scrollTop = storyContainer.scrollHeight;
        }

        // ì§„í–‰ë„ ì—…ë°ì´íŠ¸
        function updateProgress() {
            if (!story) return;

            const vars = story.variablesState;
            const investigationDepth = vars.$('investigation_depth') || 0;
            
            // ìˆ˜ì§‘í•œ ë‹¨ì„œ ê°œìˆ˜ ì„¸ê¸°
            const clueCount = Object.keys(clueInfo).filter(clueKey => 
                vars.$(clueKey) === true
            ).length;

            const progressEl = document.getElementById('progressIndicator');
            if (investigationDepth === 0) {
                progressEl.textContent = 'ì¡°ì‚¬ ì‹œì‘ ì „';
            } else {
                progressEl.textContent = `ğŸ“Š ì¡°ì‚¬ ${investigationDepth}ë‹¨ê³„ | ğŸ” ë‹¨ì„œ ${clueCount}/9ê°œ`;
            }
        }

        // ë‹¨ì„œ ë…¸íŠ¸ í‘œì‹œ
        function showClues() {
            if (!story) return;

            const vars = story.variablesState;
            const clueList = document.getElementById('clueList');
            const collectedClues = [];

            Object.keys(clueInfo).forEach(clueKey => {
                if (vars.$(clueKey) === true) {
                    collectedClues.push(clueInfo[clueKey]);
                }
            });

            if (collectedClues.length === 0) {
                clueList.innerHTML = '<div class="no-clues">ì•„ì§ ìˆ˜ì§‘í•œ ë‹¨ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                clueList.innerHTML = collectedClues.map(clue => `
                    <div class="clue-item">
                        <strong>${clue.name}</strong>
                        <div>${clue.desc}</div>
                    </div>
                `).join('');
            }

            document.getElementById('clueModal').classList.add('show');
        }

        // ë‹¨ì„œ ë…¸íŠ¸ ìˆ¨ê¸°ê¸°
        function hideClues() {
            document.getElementById('clueModal').classList.remove('show');
        }

        // Service Worker ë“±ë¡ (ìºì‹±ìœ¼ë¡œ ë¹ ë¥¸ ì¬ë°©ë¬¸)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(() => console.log('âœ… ìºì‹± í™œì„±í™”'))
                .catch(err => console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', err));
        }
    </script>
</body>
</html>
